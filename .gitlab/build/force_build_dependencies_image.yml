---
stages:
  - build

build-dependencies:
  stage: build
  tags:
    - ci-datafed-core
    - docker
  script:
    - |
      # Variables you need set in CI/CD Settings or here
      cd "$CI_PROJECT_DIR/external/DataFedDependencies"
      cd "$CI_PROJECT_DIR"
      DOWNSTREAM_SHA=$(git submodule status ./external/DataFedDependencies/ | awk '{print $1}')   # Commit SHA to trigger on
      # Remove leading '-' if one exists
      DOWNSTREAM_SHA=${DOWNSTREAM_SHA#-}
      echo "DataFedDependencies current commit: $DOWNSTREAM_SHA"
      # Trigger the downstream pipeline
      echo "Triggering downstream pipeline... $CI_API_V4_URL/projects/$DATAFED_DEPENDENCIES_GITLAB_PROJECT_ID/trigger/pipeline"
