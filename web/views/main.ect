<!DOCTYPE html>
<html>
    <head>
        <% include 'head.ect' %>
        <link href="/fancytree/skin-themeroller/ui.fancytree.min.css" rel="stylesheet">
        <script src="/fancytree/jquery.fancytree-all.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="/dlg_pick_user.js"></script>
        <script type="text/javascript" charset="utf-8" src="/dlg_set_acls.js"></script>
        <script type="text/javascript" charset="utf-8" src="/dlg_data_new_edit.js"></script>
        <script type="text/javascript" charset="utf-8" src="/dlg_groups.js"></script>
        <script type="text/javascript" charset="utf-8" src="/dlg_group_edit.js"></script>
        <script type="text/javascript" charset="utf-8" src="/dlg_proj_new_edit.js"></script>
        <script type="text/javascript" charset="utf-8" src="/main.js"></script>
        <script type="text/javascript" charset="utf-8" src="/main_browse_tab.js"></script>
        <script type="text/javascript" charset="utf-8" src="/main_repo_tab.js"></script>
        <script type="text/javascript">
            loadUser();
            if ( !g_user || !g_user.active )
                window.location.replace("/ui");
        </script>
        <title>SDMS Main</title>
    </head>
    <body>
    <div class="col-flex" style="height:100%;width:100%">
        <div class="header" style="flex:none;background-image:url('/banner.jpg');background-repeat:no-repeat;background-position:right center">
            <div style="font-size: 2em">Scientific Data Management System</div>
            <!-- div class="row-flex">
                <div style="flex:1;font-size: 2em">Scientific Data Management System</div><div style="flex:none;"><button class="btn" onclick="logout()">Log Out</button></div>
            </div -->
        </div>
        <div id="content" class="content" style="flex:1 1 100%">
            <div id="tabs">
                <ul>
                    <li><a href="#tab-browse">Dashboard</a></li>
                    <li><a href="#tab-repo">Repos</a></li>
                    <li style='display:none'><a href="#tab-admin">Admin</a></li>
                    <span style="float:right;position:relative;z-index:1"><button class="btn small" onclick="window.open('/ui/docs','sdms-docs')">Help</button>&nbsp<button class="btn small" onclick="logout()">Log Out</button></span>
                </ul>
                <div id="tab-browse">
                    <% include 'tab_browser.ect' %>
                </div>
                <div id="tab-repo">
                    <% include 'tab_repo.ect' %>
                </div>
                <div id="tab-admin">
                    <% include 'tab_admin.ect' %>
                </div>
            </div>
        </div>
        <div class="footer" style="flex:none">
            <div class="row-flex">
                <div style="flex:none" >User: <span id="uname"></span></div>
                <div style="flex:none" >&nbsp&nbsp&nbsp</div>
                <div id="status_text" class="status-bar" style="flex:1 1 100%;text-align:center"></div>
            </div>
        </div>
    </div>
    </body>
    <script>
        function resizeHandler() {
            console.log("resized!");
            $('#tabs').tabs().height(50);
            $('#tabs').tabs().height($("#content").height()-9);
            $("#tabs").tabs("refresh");
        }

        window.addEventListener( "resize", resizeHandler );

        document.getElementById("uname").innerHTML = g_user.name;

        userView( g_user.uid, function( ok, user ){
            console.log( "Use info (db):", ok, user );
            if ( ok && user ){
                g_user.isAdmin = user.isAdmin;
                if ( g_user.isAdmin )
                    $('[href="#tab-admin"]').closest('li').show();
            }
        });

        $("#tabs").tabs({heightStyle:"fill"}).css({
            'min-height': '50px',
            'overflow': 'auto'
        });

        $(".btn").button();
        $( document ).tooltip({ show: { effect: "slideDown", delay: 500 }});

        var tab_browser = makeBrowserTab();
        setupRepoTab();
        setStatusText("SDMS Ready");
    </script>
</html>
