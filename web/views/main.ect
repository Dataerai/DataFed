<!DOCTYPE html>
<html>
    <head>
        <% include 'head.ect' %>
        <link href="/fancytree/skin-themeroller/ui.fancytree.min.css" rel="stylesheet">
        <script src="/fancytree/jquery.fancytree-all.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="/dlg_set_acls.js"></script>
        <script type="text/javascript" charset="utf-8" src="/main.js"></script>
        <script type="text/javascript">
            loadUser();
            if ( !g_user || !g_user.active )
                window.location.replace("/ui");
        </script>
        <title>SDMS Main</title>
    </head>
    <body>
    <div class="col-flex" style="height:100%">
        <div class="header" style="flex:none">
            <div class="row-flex">
                <div style="flex:1;font-size: 2em">Scientific Data Management System</div><div style="flex:none;display:flex;justify-content:flex-end"><button class="btn" onclick="test()">Test</button><button class="btn" onclick="logout()">Log Out</button></div>
            </div>
        </div>
        <div id="content" class="content" style="flex:1 1 100%">
            <div id="tabs">
                <ul>
                    <li><a href="#tab-1">Data</a></li>
                    <li><a href="#tab-2">Projects</a></li>
                    <li><a href="#tab-3">Settings</a></li>
                </ul>
                <div id="tab-1">
                    <div class="col-flex" style="padding:0;height:100%;box-sizing: border-box;">
                        <div class="row-flex" style="flex:1 1 100%">
                            <div class="col-flex" style="flex:1 1 40%;padding:.25em">
                                <div style="flex:none">Collections &amp Data:</div>
                                <div class="ui-widget-content text" style="flex:1 1 100%;overflow:auto">
                                    <div id="data_tree" class="no-border"></div>
                                </div>
                            </div>
                            <div class="col-flex" style="flex:1 1 60%;padding:.25em">
                                <div style="flex:none">Selection Details:</div>
                                <div id="data_info" class="ui-widget-content text" style="flex:1 1 100%"></div>
                            </div>
                        </div>
                        <div style="flex:none;padding:.25em">
                            <!-- input type="checkbox" id="lock_btn"><label title="Allow drag and drop within Collections & Data window" for="lock_btn">Unlock</label></input -->
                            <button class="btn" onclick="newData()">New Data</button>
                            <button class="btn" onclick="newColl()">New Coll.</button>
                            <button class="btn act-folder act-data" onclick="editSelected()" disabled>Edit</button>
                            <button class="btn act-folder act-data" onclick="deleteSelected()" disabled>Delete</button>
                            <button class="btn act-folder act-data" onclick="shareSelected()" disabled>Sharing</button>
                            <button class="btn act-data" onclick="xfrSelected(0)" disabled>Upload</button>
                            <button class="btn act-data" onclick="xfrSelected(1)" disabled>Download</button>
                        </div>
                        <div style="flex:none;padding:.5em 0 0 0">Transfer History:</div>
                        <div id="xfr_hist" style="flex:none">
                        </div>
                    </div>
                </div>
                <div id="tab-2">
                </div>
                <div id="tab-3">
                </div>
            </div>
        </div>
        <div class="footer" style="flex:none">
            User: <span id=uname></span>
        </div>
    </div>
    <div id='dlg_new' style='display:none'>
        <table style='width:100%'>
        <tr><td>Title:</td><td><input type='text' id='title' style='width:100%'></input></td></tr>
        <tr><td>Alias:</td><td><input type='text' id='alias' style='width:100%'></input></td></tr>
        <tr><td >Description:</td><td><textarea id='desc' rows=3 style='width:100%'></textarea></td></tr>
        <tr id='dlg_md_row'><td>Metadata:</td><td><textarea id='md' rows=3 style='width:100%'></textarea></td></tr>
        <tr id='dlg_md_row2'><td>Metadata mode:</td><td>
            <input type="radio" id="md_merge" name="md_mode" value="merge" checked>
            <label for="md_merge">Merge</label>
            <input type="radio" id="md_set"  name="md_mode" value="set">
            <label for="md_mode">Set</label>
            </td></tr>
        <tr id='dlg_coll_row'><td>Parent:</td><td><input type='text' id='coll' style='width:100%'></input></td></tr>
        </table>
    </div>
    <div id='dlg_xfr' style='display:none'>
        <table style='width:100%'>
        <tr><td>Title:</td><td><input disabled type='text' id='title' style='width:100%'></input></td></tr>
        <tr><td>Alias:</td><td><input disabled type='text' id='alias' style='width:100%'></input></td></tr>
        <tr><td >Description:</td><td><textarea disabled id='desc' rows=3 style='width:100%'></textarea></td></tr>
        <tr><td>Metadata:</td><td><textarea disabled id='md' rows=3 style='width:100%'></textarea></td></tr>
        <tr><td>Path:</td><td><input type='text' id='path' style='width:100%'></input></td></tr>
        </table>
    </div>
    <div id="app_dlg" style='display:none'></div>
    <div id='dlg_alert' style='display:none'></div>
    </body>
    <script>
        function resizeHandler() {
            console.log("resized!");
            $('#tabs').tabs().height(50);
            $('#tabs').tabs().height($("#content").height()-9);
            $("#tabs").tabs("refresh");
        }

        var drag_mode = 0;
        var drag_enabled = 1;
        var root_key = "c/" + g_user.uid + "_root";

        window.addEventListener( "resize", resizeHandler );

        document.getElementById("uname").innerHTML = g_user.name;

        $("#tabs").tabs({heightStyle:"fill"}).css({
            'min-height': '50px',
            'overflow': 'auto'
        });

        $(".btn").button();


        /*
        $( "#lock_btn" ).button().click(function() {
            if ( this.checked )
                drag_enabled = 1;
            else
                drag_enabled = 0;
        });*/
        $( document ).tooltip({ show: { effect: "slideDown", delay: 500 }});

        setupDataTree();
    </script>
</html>
