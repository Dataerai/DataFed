package SDMS;

// ============================ Enums

enum ErrorCode
{
    ID_BAD_REQUEST              = 1;
    ID_INTERNAL_ERROR           = 2;
    ID_CLIENT_ERROR             = 3;
    ID_SERVICE_ERROR            = 4;
    ID_AUTHN_REQUIRED           = 5;
    ID_AUTHN_ERROR              = 6;
    ID_DEST_PATH_ERROR          = 7;
    ID_DEST_FILE_ERROR          = 8;
}

enum ServiceStatus
{
    SS_NORMAL       = 0;
    SS_DEGRADED     = 1;
    SS_FAILED       = 2;
    SS_OFFLINE      = 3;
}

enum XfrMode
{
    XM_GET          = 0;
    XM_PUT          = 1;
}

enum XfrStatus
{
    XS_INIT         = 0;
    XS_ACTIVE       = 1;
    XS_INACTIVE     = 2;
    XS_SUCCEEDED    = 3;
    XS_FAILED       = 4;
}

enum CollMode
{
    CM_ALL          = 0;
    CM_COLL         = 1;
    CM_DATA         = 2;
}

enum Permissions
{
    PERM_NONE       = 0x000;
    PERM_LIST       = 0x001;   // Find record by browsing
    PERM_VIEW       = 0x002;   // Read public record fields (not collection items or raw data)
    PERM_UPDATE     = 0x004;   // Update public record fields
    PERM_ADMIN      = 0x008;   // Read, write admin fields, delete record
    PERM_TAG        = 0x010;   // Add/remove tags on record
    PERM_NOTE       = 0x020;   // Add, remove, edit annotations on record
    PERM_READ       = 0x040;   // Read raw data or list collection items
    PERM_WRITE      = 0x080;   // Write raw data or add/remove collection items
    PERM_CREATE     = 0x100;   // Create new data or collections
    PERM_ALL        = 0x1FF;
}


// ============================ Data Structures

message UserData
{
    required string             uid         = 1;
    required string             name        = 2;
    optional string             email       = 3;
    optional string             phone       = 4;
    optional bool               is_admin    = 5;
    optional bool               is_project  = 6;
    repeated string             admin       = 7;
    repeated string             ident       = 8;
}

message ProjectData
{
    required string             id          = 1;
    required string             title       = 2;
    optional string             domain      = 3;
    optional string             repo        = 4;
    optional string             owner       = 5;
    repeated string             admin       = 6;
    repeated string             member      = 7;
}

message RecordData
{
    required string             id          = 1;
    required string             title       = 2;
    optional string             alias       = 3;
    optional string             desc        = 4;
    optional bool               is_public   = 5;
    optional string             metadata    = 6;
    optional string             data_path   = 7;
    optional uint64             data_size   = 8;
    optional uint64             rec_time    = 9;
    optional uint64             data_time   = 10;
    optional string             owner       = 11;
}

message CollData
{
    required string             id          = 1;
    required string             title       = 2;
    optional string             alias       = 3;
    optional string             desc        = 4;
    optional string             owner       = 5;
}

message XfrData
{
    required string             id          = 1;
    required XfrMode            mode        = 2;
    required XfrStatus          status      = 3;
    required string             data_id     = 4; // With revision?
    required string             repo_path   = 5;
    required string             local_path  = 6;
    required string             user_id     = 7;
    required string             repo_id     = 8;
    required uint64             updated     = 9;
    optional string             task_id     = 10; // Only set if status > XFR_INIT
    optional string             err_msg     = 11; // Only set if status == XFR_FAILED
}

message GroupData
{
    required string             uid         = 1;
    required string             gid         = 2;
    optional string             title       = 3;
    optional string             desc        = 4;
    repeated string             member      = 5;
}

message ACLRule
{
    required string             id          = 1;
    optional uint32             grant       = 2;
    optional uint32             deny        = 3;
    optional uint32             inhgrant    = 4;
    optional uint32             inhdeny     = 5;
}

message RepoData
{
    required string             id          = 1;
    optional string             title       = 2;
    optional string             desc        = 3;
    required uint64             total_sz    = 4;
    required string             pub_key     = 5;
    required string             address     = 6;
    required string             endpoint    = 7;
}
