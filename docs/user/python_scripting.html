

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Python Scripting &mdash; DataFed 1.4 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Administration" href="../admin/general.html" />
    <link rel="prev" title="Scripting Guide" href="scripting.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> DataFed
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">About DataFed</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../system/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/overview.html">System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/usecases.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/getting_started.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Web Portal</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="web/portal.html">Web Portal</a></li>
</ul>
<p class="caption"><span class="caption-text">Command Line Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cli/install.html">Installation and Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli/guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli/reference.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli/shell_scripting.html">Shell Scripting</a></li>
</ul>
<p class="caption"><span class="caption-text">Python Interface</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting.html">Scripting Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Python Scripting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#help-and-documentation">Help and documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#import-package">Import package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-instance">Create instance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#create-data-record">Create Data Record</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prepare-scientific-metadata">Prepare (scientific) metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-the-record">Create the record</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reading-datafed-response">Reading DataFed response</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#upload-raw-data">Upload raw data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#view-data-record">View Data Record</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#extract-metadata">Extract metadata</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#download-data">Download Data</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Administration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin/general.html">Administration</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DataFed</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Python Scripting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user/python_scripting.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python-scripting">
<h1>Python Scripting</h1>
<p>Below, we show simple examples of how one could use DataFed’s Python interface to
create data records in DataFed data repositories, put raw data into those records,
as well as download the raw data from records.</p>
<div class="section" id="help-and-documentation">
<h2>Help and documentation</h2>
<p>Users are encouraged to refer to the extensive <a class="reference external" href="https://ornl.github.io/DataFed/autoapi/datafed/CommandLib/index.html">documentation of DataFed’s CLI class</a>
for complete information on how to interact with DataFed using the Python interface.</p>
</div>
<div class="section" id="getting-started">
<h2>Getting Started</h2>
<p>Users are recommended to follow our <a class="reference external" href="https://ornl.github.io/DataFed/system/getting_started.html">getting-started guide</a> to install DataFed on the machine(s) they intend to use DataFed on</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ensure that the Globus endpoint associated with the machine where you use DataFed is active.</p>
</div>
<div class="section" id="import-package">
<h3>Import package</h3>
<p>We start by importing just the <code class="docutils literal notranslate"><span class="pre">API</span></code> class within <code class="docutils literal notranslate"><span class="pre">datafed.CommandLib</span></code> as shown below.
We also import json to simplify the process of communicating metadata with DataFed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datafed.CommandLib</span> <span class="kn">import</span> <span class="n">API</span>
</pre></div>
</div>
</div>
<div class="section" id="create-instance">
<h3>Create instance</h3>
<p>Finally, we create an instance of the DataFed API class via:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df_api</span> <span class="o">=</span> <span class="n">API</span><span class="p">()</span>
</pre></div>
</div>
<p>We can now use <code class="docutils literal notranslate"><span class="pre">df_api</span></code> to communicate with DataFed</p>
</div>
</div>
<div class="section" id="create-data-record">
<h2>Create Data Record</h2>
<div class="section" id="prepare-scientific-metadata">
<h3>Prepare (scientific) metadata</h3>
<p>Users can derive a lot more value from DataFed if they provide more contextual information about their data which can be mined or queried later on.
Therefore, users are highly encouraged to provide contextual information such as scientific metadata along with raw data.
This metadata could by any supporting information that would help the user in identifying, searching for, and organizing data.</p>
<p>For example, if one were performing simulations, this could be the exact combination of parameters relevant to the simulation.
Alternatively, if one were performing measurements on an instrument, the metadata could include information about the sample / system being interroaged,
measurement parameters such as resolution, speeds, spectroscopic parameters, etc.</p>
<p>By default, one would need to get metadata from the simulation’s input parameters file or output log files.
Similarly users may need to extract header information from measurement files as the metadata for DataFed.</p>
<p>DataFed can accept metadata as dictionaries in python or as a JSON file.</p>
<p>Here, we simply create a dictionary with fake metadata in place of the real metadata:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
<span class="go">                  &#39;a&#39;: 4,</span>
<span class="go">                  &#39;b&#39;: [1, 2, -4, 7.123],</span>
<span class="go">                  &#39;c&#39;: &#39;Something important&#39;,</span>
<span class="go">                  &#39;d&#39;: {&#39;x&#39;: 14, &#39;y&#39;: -19} # Can use nested dictionaries</span>
<span class="go">                  }</span>
</pre></div>
</div>
</div>
<div class="section" id="create-the-record">
<h3>Create the record</h3>
<p>Until a future version of DataFed, which can accept a python dictionary itself instead
of a JSON file or a JSON string for the metadata, we will need to use <code class="docutils literal notranslate"><span class="pre">json.dumps()</span></code>
or write the dictionary to a JSON file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">df_api</span><span class="o">.</span><span class="n">dataCreate</span><span class="p">(</span><span class="s1">&#39;my important data&#39;</span><span class="p">,</span>
<span class="go">                                 alias=&#39;my_cool_alias&#39;, # optional</span>
<span class="go">                                 metadata=json.dumps(parameters), # also optional</span>
<span class="go">                                 parent_id=&#39;root&#39;, # parent collection</span>
<span class="go">                                )</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">parent_id</span></code> keyword argument to create the record within a
specific collection, for example within a project.</p>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">parent_id</span></code> was set to the default value of <code class="docutils literal notranslate"><span class="pre">root</span></code> which means that
the Data Record would be created within the user’s private collection.</p>
<p>We encourage users to create a variable in the very beginning of the script
capturing information about the starting location where DataFed Records
would be created and operated on. This variable could be used for the <code class="docutils literal notranslate"><span class="pre">parent_id</span></code>.</p>
</div>
<div class="section" id="reading-datafed-response">
<h3>Reading DataFed response</h3>
<p>DataFed returns Google Protobuf messages in response to commands (both success and failure).</p>
<p>Here is the response form the above <code class="docutils literal notranslate"><span class="pre">dataCreate()</span></code> command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="go">(data {</span>
<span class="go">   id: &quot;d/30224875&quot;</span>
<span class="go">   title: &quot;my important data&quot;</span>
<span class="go">   alias: &quot;my_cool_alias&quot;</span>
<span class="go">   metadata: &quot;{\&quot;a\&quot;:4,\&quot;b\&quot;:[1,2,-4,7.123],\&quot;c\&quot;:\&quot;Something important\&quot;,\&quot;d\&quot;:{\&quot;x\&quot;:14,\&quot;y\&quot;:-19}}&quot;</span>
<span class="go">   repo_id: &quot;repo/cades-cnms&quot;</span>
<span class="go">   size: 0.0</span>
<span class="go">   ext_auto: true</span>
<span class="go">   ct: 1605133166</span>
<span class="go">   ut: 1605133166</span>
<span class="go">   owner: &quot;u/somnaths&quot;</span>
<span class="go">   creator: &quot;u/somnaths&quot;</span>
<span class="go">   parent_id: &quot;c/u_somnaths_root&quot;</span>
<span class="go"> }, &#39;RecordDataReply&#39;)</span>
</pre></div>
</div>
<p>We would get the same response if we viewed basic information about a Data Record
using the <code class="docutils literal notranslate"><span class="pre">dataView()</span></code> command.</p>
<p>Though the content in these message objects are clearly laid out for humans to read and understand,
getting the specific components of the messages requires a tiny bit of extra indexing work.</p>
<p>For example, if we wanted to get the record ID to be used for later transactions,
here’s how we could go about it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">record_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">record_id</span><span class="p">)</span>

<span class="go">&#39;d/30224875&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="upload-raw-data">
<h2>Upload raw data</h2>
<p>So far, the Data Record created above only contains simple text information
along with the scientific metadata. It does not have the raw data that we
colloquially refer to as “data” in science.</p>
<p>For the sake of demonstration, we will just use the metadata as the data itself:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;parameters.json&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handle</span><span class="p">:</span>
<span class="go">        json.dump(parameters, file_handle)</span>
</pre></div>
</div>
<p>With the data file created, we are ready to put this raw data into the record we created above.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The raw data file must be located such that it is visible to the (default) Globus endpoint</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ensure that the Globus endpoint that will be used for uploading data is active.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">put_resp</span> <span class="o">=</span> <span class="n">df_api</span><span class="o">.</span><span class="n">dataPut</span><span class="p">(</span><span class="n">record_id</span><span class="p">,</span>
<span class="go">                              &#39;./parameters.json&#39;, # raw data file</span>
<span class="go">                              )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">put_resp</span><span class="p">)</span>

<span class="go">(item {</span>
<span class="go">   id: &quot;d/30224875&quot;</span>
<span class="go">   title: &quot;my important data&quot;</span>
<span class="go">   size: 0.0</span>
<span class="go">   owner: &quot;u/somnaths&quot;</span>
<span class="go"> }</span>
<span class="go"> task {</span>
<span class="go">   id: &quot;task/30225166&quot;</span>
<span class="go">   type: TT_DATA_PUT</span>
<span class="go">   status: TS_READY</span>
<span class="go">   client: &quot;u/somnaths&quot;</span>
<span class="go">   step: 0</span>
<span class="go">   steps: 2</span>
<span class="go">   msg: &quot;Pending&quot;</span>
<span class="go">   ct: 1605133526</span>
<span class="go">   ut: 1605133526</span>
<span class="go">   source: &quot;1646e89e-f4f0-11e9-9944-0a8c187e8c12/Users/syz/Desktop/parameters.json&quot;</span>
<span class="go">   dest: &quot;d/30224875&quot;</span>
<span class="go"> }, &#39;DataPutReply&#39;)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">dataPut()</span></code> method initiates a Globus transfer on our behalf
from the machine where the command was entered to wherever the default data repository is located.</p>
<p>In addition, the <code class="docutils literal notranslate"><span class="pre">dataPut()</span></code> method prints out the status of the Globus transfer as shown under the <code class="docutils literal notranslate"><span class="pre">task</span></code> section of the response.
The <code class="docutils literal notranslate"><span class="pre">task</span></code> <code class="docutils literal notranslate"><span class="pre">msg</span></code> shows that the Globus transfer was pending and was not yet complete at the time when the response was printed.</p>
<p>If it is important that the code not proceed until the transfer is complete,
users are recommended to set the <code class="docutils literal notranslate"><span class="pre">wait</span></code> keyword argument in the <code class="docutils literal notranslate"><span class="pre">dataPut()</span></code> method to <code class="docutils literal notranslate"><span class="pre">True</span></code>
and instead use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">put_resp</span> <span class="o">=</span> <span class="n">df_api</span><span class="o">.</span><span class="n">dataPut</span><span class="p">(</span><span class="n">record_id</span><span class="p">,</span>
<span class="go">                              &#39;./parameters.json&#39;,</span>
<span class="go">                              wait=True, # Waits until transfer completes.</span>
<span class="go">                              )</span>
</pre></div>
</div>
</div>
<div class="section" id="view-data-record">
<h2>View Data Record</h2>
<p>We can get all information regarding a Data Record, except for the raw data itself, using the <code class="docutils literal notranslate"><span class="pre">dataView()</span></code> method.</p>
<p>Here we try to view the Data Record we have been working on so far:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dv_resp</span> <span class="o">=</span> <span class="n">df_api</span><span class="o">.</span><span class="n">dataView</span><span class="p">(</span><span class="n">record_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prit</span><span class="p">(</span><span class="n">dv_resp</span><span class="p">)</span>

<span class="go">(data {</span>
<span class="go">   id: &quot;d/30224875&quot;</span>
<span class="go">   title: &quot;my important data&quot;</span>
<span class="go">   alias: &quot;my_cool_alias&quot;</span>
<span class="go">   metadata: &quot;{\&quot;a\&quot;:4,\&quot;b\&quot;:[1,2,-4,7.123],\&quot;c\&quot;:\&quot;Something important\&quot;,\&quot;d\&quot;:{\&quot;x\&quot;:14,\&quot;y\&quot;:-19}}&quot;</span>
<span class="go">   repo_id: &quot;repo/cades-cnms&quot;</span>
<span class="go">   size: 86.0</span>
<span class="go">   source: &quot;1646e89e-f4f0-11e9-9944-0a8c187e8c12/Users/syz/Desktop/parameters.json&quot;</span>
<span class="go">   ext: &quot;.json&quot;</span>
<span class="go">   ext_auto: true</span>
<span class="go">   ct: 1605133166</span>
<span class="go">   ut: 1605133539</span>
<span class="go">   dt: 1605133539</span>
<span class="go">   owner: &quot;u/somnaths&quot;</span>
<span class="go">   creator: &quot;u/somnaths&quot;</span>
<span class="go">   notes: 0</span>
<span class="go"> }, &#39;RecordDataReply&#39;)</span>
</pre></div>
</div>
<p>Comparing this response against the response we got from the <code class="docutils literal notranslate"><span class="pre">dataCreate()</span></code> call,
you will notice the source and file extension have been updated.</p>
<div class="section" id="extract-metadata">
<h3>Extract metadata</h3>
<p>As the response above shows, the metadata is also part of the response we got from <code class="docutils literal notranslate"><span class="pre">dataView()</span></code>.</p>
<p>By default, the metadata in the response is formatted as a JSON string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dv_resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>

<span class="go">&#39;{&quot;a&quot;:4,&quot;b&quot;:[1,2,-4,7.123],&quot;c&quot;:&quot;Something important&quot;,&quot;d&quot;:{&quot;x&quot;:14,&quot;y&quot;:-19}}&#39;</span>
</pre></div>
</div>
<p>In order to get back a python dictionary, use <code class="docutils literal notranslate"><span class="pre">json.loads()</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dv_resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

<span class="go">{&#39;a&#39;: 4,</span>
<span class="go"> &#39;b&#39;: [1, 2, -4, 7.123],</span>
<span class="go"> &#39;c&#39;: &#39;Something important&#39;,</span>
<span class="go"> &#39;d&#39;: {&#39;x&#39;: 14, &#39;y&#39;: -19}}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="download-data">
<h2>Download Data</h2>
<ul class="simple">
<li><p>Display contents of current director</p></li>
<li><p>Get data</p></li>
<li><p>Show task information</p></li>
<li><p>Display contents of current directory</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Users are recommended to perform data orchestration (especially large data movement - upload / download) operations
outside the scope of heavy / parallel computation operations in order to avoid wasting precious wall time on compute clusters.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../admin/general.html" class="btn btn-neutral float-right" title="Administration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scripting.html" class="btn btn-neutral float-left" title="Scripting Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Oak Ridge National Laboratories

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>